<!--
title: Api Endpoints
description: Pamaxie's API endpoint definitions with some documentation on how to properly call them or more information on what to watch out for.
published: false
date: 2022-04-12T17:10:40.932Z
tags: api
editor: ckeditor
dateCreated: 2022-04-10T19:06:00.780Z
-->

<h1>Database API</h1>
<h2>General Information</h2>
<h3>Authorization</h3>
<ul>
  <li>For initially authenticating with the Scanning API we use a custom authentication format. This is only required for the initial authentication (login). After that we continue to use Bearer Authentication. Our own Authentication method (PamAuth) requires a token (Prefixed by PamToken/-//). The usually Auth header should look a bit like this:&nbsp;<br><code>Token PamToken/-//956927111468163072/-//956927426313601024/-//1023981Zjaflkjaqweoiasfja</code></li>
</ul>
<h2>User Service</h2>
<h3>Create User Account</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/user/create
Authorization: None
Content-Type: application/json
Request Body:
	{
    	"Id": 0,
    	"Email": "john@wolf.email",
    	"UserName": "John",
    	"LastName": "Wolf",
    	"FirstName": "John",
    	"PasswordHash": "$argon2i$v=19$m=4096,t=10,p=1$1023819823091820jaflkjasodu91283ukj%",
    	"KnownIps": null,
    	"Projects": null,
    	"Flags": 0,
    	"CreationDate": "0001-01-01T00:00:00",
    	"TTL": "2022-09-05T13:17:50.155621+02:00"
	}
	
------------	
Notes:

#These properties may not be set:
# - Id
# - KnownIps
# - Projects
# - Flags
# - CreationDate
# - TTL
#These properties must be set:
# - Email
# - UserName
# - LastName
# - FirstName
# - PasswordHash
#These properties may be set:
# - TTL

#The password hash should always be set to an argon2 hash. Please ensure you're giving it a decent
#amount of rounds (10 or more preferably)

#Setting a TTL will make the account volotile (self delete if not used for a certain amount of time),
#we generally do not advise against setting this.

#Setting the Id, KnownIps, Projects, Flags or CreationDate has no effect and will be ignored.</code></pre>
<h3>Login User Account</h3>
<pre><code class="language-plaintext">Request Type: GET
Request Url: /db/v1/user/login
Authorization: Basic
Content-Type: Text
Request Body (Optional): (LongLived = true)
Returns: 
{
    "Token": {
        "Token": "TokenString",
        "ExpiresAtUTC": "2022-05-12T15:09:17.9476967+00:00",
        "IsLongLived": true
    },
    "User": {
        "Id": 956925542190288896,
        "Email": "john@doe.mail",
        "UserName": "JohnDoe",
        "LastName": "John",
        "FirstName": "Doe",
        "PasswordHash": null,
        "KnownIps": [],
        "Projects": [],
        "Flags": 18,
        "CreationDate": "2022-03-25T14:41:03.045039Z",
        "TTL": "2022-09-05T11:17:50.155621Z"
    }
}
------------	
Notes:

#You may enter a request body with the contents of: "LongLived = true", 
#this ensures we return a long lived token

#Authoriziation maybe done over Username and Password of the individuals user account encoded
#into a base64 string and seperated by a ':' character.</code></pre>
<h3>Update User Account</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/user/create
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
	{
    	"Id": 0,
    	"Email": "john@doe.mail",
    	"UserName": "JohnDoe",
    	"LastName": "Wolf",
    	"FirstName": "John",
    	"PasswordHash": "$argon2i$v=19$m=4096,t=10,p=1$1023819823091820jaflkjasodu91283ukj%",
    	"KnownIps": null,
    	"Projects": null,
    	"Flags": 0,
    	"CreationDate": "0001-01-01T00:00:00",
    	"TTL": "2022-09-05T13:17:50.155621+02:00"
	}
	
------------	
Notes:

#These properties may not be set:
# - Id
# - PasswordHash
# - KnownIps
# - Projects
# - Flags
# - CreationDate
# - TTL
#These properties may be set:
# - Email
# - UserName
# - LastName
# - FirstName
# - PasswordHash
# - TTL

#If the password hash is set we will change this accounts password, if it is left as null
#we will simply ignore its content.

#Setting a TTL will make the account volotile (self delete if not used until the TTL date),
#we generally do not advise against setting this.

#Setting the Id, KnownIps, Projects, Flags or CreationDate has no effect and will be ignored.</code></pre>
<h3>Delete User Account</h3>
<pre><code class="language-plaintext">Request Type: DELETE
Request Url: /db/v1/user/delete={userId}
Authorization: JWT Bearer
Content-Type: EMPTY
Request Body: EMPTY
Return Body: "The requested users account has been deleted"

------------	
Notes:

#You may only delete your own user account.

#The path of the request after delete= specifies the users Id to be deleted.

#The user that has been deleted recieves an email about their account being deleted.</code></pre>
<h3>Get User Account</h3>
<pre><code class="language-plaintext">Request Type: GET
Request Url: /db/v1/user/get={userId}
Authorization: JWT Bearer
Content-Type: EMPTY
Request Body: EMPTY
Return Body:
{
    "Id": 963460958875815936,
    "Email": "john@doe.mail",
    "UserName": "JohnDoe",
    "LastName": "John",
    "FirstName": "Doe",
    "PasswordHash": "",
    "KnownIps": [],
    "Projects": [],
    "Flags": 18,
    "CreationDate": "2022-04-12T15:34:31.300681Z",
    "TTL": "2022-09-05T11:17:50.155621Z"
}
	
------------	
Notes:

#You may only get your own user account.

#The path of the request after get= specifies the users Id to get.

#We return the same object that the login request returns during a get (minimal)</code></pre>
<h3>Refresh Token</h3>
<pre><code class="language-plaintext">Request Type: GET
Request Url: /db/v1/user/refreshToken
Authorization: JWT Bearer
Content-Type: EMPTY
Request Body: EMPTY
Return Body:
{
    "token": "Token",
    "expiresAtUTC": "2022-05-12T15:43:20.8306105+00:00",
    "isLongLived": true
}
	
------------	
Notes:</code></pre>
<h3>Is IP Known</h3>
<pre><code class="language-plaintext">Request Type: GET
Request Url: /db/v1/user/IsIpKnown={IP}
Authorization: JWT Bearer
Content-Type: EMPTY
Request Body: EMPTY
Return Body: boolean (true / false)
	
------------	
Notes:

#The body returns either a "true" or "false" depending if the IP address is known to have accessed
#this users account before

#The path of the request after IsIpKnown= specifies the IP address to validate against</code></pre>
<h3>Get User Id</h3>
<pre><code class="language-plaintext">Request Type: GET
Request Url: /db/v1/user/GetId={QueryParam}
Authorization: JWT Bearer
Content-Type: EMPTY
Request Body: EMPTY
Return Body: long
	
------------	
Notes:

#This endpoint returns the users Id depending on the query parameter after GetId=

#The Query parameters maybe a Username or Email

#This endpoint may only be used by Pamaxies staff team</code></pre>
<h3>Load Known IPs</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/user/LoadIPs
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
{
    "Id": 963460958875815936
}
Return Body:
{
    "Id": 963460958875815936,
    "Email": "john@doe.mail",
    "UserName": "JohnDoe",
    "LastName": "John",
    "FirstName": "Doe",
    "PasswordHash": null,
    "KnownIps": [
        "192.168.1.1"
    ],
    "Projects": [],
    "Flags": 18,
    "CreationDate": "2022-04-12T15:34:31.300681Z",
    "TTL": "2022-09-05T11:17:50.155621Z"
}
	
------------	
Notes:

#This endpoint loads the Users known IP addresses.

#We only require a minimal object to be returned to us (We really just require the Id Property
#being set like in this example). You can however send us the entire User Object as well.</code></pre>
<h3>Load Projects</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/user/LoadProject
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
{
    "Id": 963460958875815936
}
Return Body:
{
    "Id": 963460958875815936,
    "Email": "john@doe.mail",
    "UserName": "JohnDoe",
    "LastName": "John",
    "FirstName": "Doe",
    "PasswordHash": null,
    "KnownIps": [],
    "Projects": [
        {
            "Item1": {
                "Id": 963469917997244416,
                "Name": "TestProject",
                "Owner": {
                    "Data": {
                        "Item1": null,
                        "Item2": 963460958875815936
                    },
                    "IsLoaded": false
                },
                "LastModifiedUser": {
                    "Data": {
                        "Item1": null,
                        "Item2": 0
                    },
                    "IsLoaded": false
                },
                "Users": [],
                "ApiTokens": [],
                "Flags": 0,
                "CreationDate": "2022-04-12T16:05:28.857717Z",
                "LastModifiedAt": "2022-04-12T16:05:28.85561Z",
                "TTL": null
            },
            "Item2": 963469918093721600
        }
    ],
    "Flags": 18,
    "CreationDate": "2022-04-12T15:34:31.300681Z",
    "TTL": "2022-09-05T11:17:50.155621Z"
}
	
------------	
Notes:

#This endpoint loads the Users Projects

#We only require a minimal object to be returned to us (We really just require the Id Property
#being set like in this example). You can however send us the entire User Object as well.</code></pre>
<h3>Load Fully</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/user/LoadProject
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
{
    "Id": 963460958875815936
}
Return Body:
{
    "Id": 963460958875815936,
    "Email": "john@doe.mail",
    "UserName": "JohnDoe",
    "LastName": "John",
    "FirstName": "Doe",
    "PasswordHash": null,
    "KnownIps": [
        "192.168.1.1"
    ],
    "Projects": [
        {
            "Item1": {
                "Id": 963469917997244416,
                "Name": "TestProject",
                "Owner": {
                    "Data": {
                        "Item1": null,
                        "Item2": 963460958875815936
                    },
                    "IsLoaded": false
                },
                "LastModifiedUser": {
                    "Data": {
                        "Item1": null,
                        "Item2": 0
                    },
                    "IsLoaded": false
                },
                "Users": [],
                "ApiTokens": [],
                "Flags": 0,
                "CreationDate": "2022-04-12T16:05:28.857717Z",
                "LastModifiedAt": "2022-04-12T16:05:28.85561Z",
                "TTL": null
            },
            "Item2": 963469918093721600
        }
    ],
    "Flags": 18,
    "CreationDate": "2022-04-12T15:34:31.300681Z",
    "TTL": "2022-09-05T11:17:50.155621Z"
}
	
------------	
Notes:

#This endpoint loads the entire User Object

#We generally advise against using this endpoint if you do not need all of this data.

#We only require a minimal object to be returned to us (We really just require the Id Property
#being set like in this example). You can however send us the entire User Object as well.</code></pre>
<h2>ProjectService</h2>
<h3>Create Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/create
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
{
    "Id": 0,
    "Name": "TestProject",
    "Owner": null,
    "LastModifiedUser": null,
    "Users": null,
    "ApiTokens": null,
    "Flags": 0,
    "CreationDate": "0001-01-01T00:00:00",
    "LastModifiedAt": "0001-01-01T00:00:00",
    "TTL": null
}
Return Body: 963475102257651712
------------	
Notes:

#These properties may not be set:
# - Id
# - KnownIps
# - Owner
# - LastModifiedUser
# - Users
# - ApiTokens
# - CreationDate
# - LastModifiedAt
# - TTL
#These properties must be set:
# - Name
#These properties may be set:
# - TTL

#We generally do not recommend setting a TTL for a Project since this will automatically delete the
#project if their API tokens are not accessed (which means if no API tokens are set it will be
#deleted)

#We recommend only giving us a Project Name (aka Json data minimilized to just the Name of a Project)
#this is to reduce network load

#We ignore any values set to: Id, KnownIps, Owner, LastModifiedUser, Users, ApiTokens, CreationDate
#or LastModifiedAt</code></pre>
<h3>Update Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/update
Authorization: JWT Bearer
Content-Type: application/json
Request Body:
{
    "Id": 963475102257651712,
    "Name": "TestProject",
    "Owner": null,
    "LastModifiedUser": null,
    "Users": null,
    "ApiTokens": null,
    "Flags": 0,
    "CreationDate": "0001-01-01T00:00:00",
    "LastModifiedAt": "0001-01-01T00:00:00",
    "TTL": null
}
Return Body: EMPTY
------------	
Notes:

#These properties may not be set:
# - Id
# - KnownIps
# - Owner
# - LastModifiedUser
# - Users
# - ApiTokens
# - CreationDate
# - LastModifiedAt
# - TTL
#These properties must be set:
# - Name
#These properties may be set:
# - TTL

#We generally do not recommend setting a TTL for a Project since this will automatically delete the
#project if their API tokens are not accessed (which means if no API tokens are set it will be
#deleted)

#You can change the ProjectName with this endpoint, everything else is handled through seperate
#enpoints. We might allow for more things to be changed later on.

#We ignore any values set to: Id, KnownIps, Owner, LastModifiedUser, Users, ApiTokens, CreationDate
#or LastModifiedAt

#You require write Permissions on the Project to update it</code></pre>
<h3>Get Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/get={ProjectId}
Authorization: JWT Bearer
Content-Type: application/json
Request Body: EMPTY
Return Body:
{
    "Id": 963475102257651712,
    "Name": "ProjectName",
    "Owner": {
        "Data": {
            "Item1": null,
            "Item2": 963460958875815936
        },
        "IsLoaded": false
    },
    "LastModifiedUser": {
        "Data": {
            "Item1": null,
            "Item2": 0
        },
        "IsLoaded": false
    },
    "Users": [],
    "ApiTokens": [],
    "Flags": 0,
    "CreationDate": "2022-04-12T16:26:04.880209Z",
    "LastModifiedAt": "2022-04-12T16:26:04.880033Z",
    "TTL": null
}
------------	
Notes:

#The path of the request after get= should specify the id of the project you want to get (Project Id)

#You require read permissions on a project to get it</code></pre>
<h3>Delete Project</h3>
<pre><code class="language-plaintext">Request Type: DELETE
Request Url: /db/v1/project/delete={ProjectId}
Authorization: JWT Bearer
Content-Type: application/json
Request Body: EMPTY
Return Body: EMPTY
------------	
Notes:

#The path of the request after delete= should specify the id of the project you want to delete 
#(Project Id)

#You require administrative permissions on the project to delete it</code></pre>
<h3>Create API Token for Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/createToken
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "ProjectId": 956927111468163072,
    "ExpiresAtUTC": "9999-12-31T22:59:59.9999999Z"
}
Return Body:
PamToken/-//963469917997244416/-//963482075615215616/-//1083019283012830uafoiaj012938jf838394jafDFJA
------------	
Notes:

#Creating a token serves you a PamToken. This is a credential, but we only save its ARGON2
#Representation in our database. Please make sure to store this credential somewhere secure and NEVER
#share it.

#The ExpiresAtUTC specifies an expirition time for the token. You can set this to any date but it
#has to be set for security reasons.

#You require write permissions on the project to create a token</code></pre>
<h3>Delete API Token for Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/createToken
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "ProjectId": 963469917997244416,
    "TokenId": 963482075615215616
}
Return Body: NONE
------------	
Notes:

#Deleting a Token revokes it's access and makes any request through this token impossible

#You require write permissions on the project to delete a token</code></pre>
<h3>Add User to Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/addUser
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "ProjectId": 950835844418117632,
    "UserId": 949716012092100608,
    "Permissions": 128
}
Return Body: NONE
------------	
Notes:

#Please ensure you set the proper permissions for the user otherwise their acccess to the project
#will be highly limited (We recommend at LEAST read permissions)

#You require administrator permissions to add a user to a project</code></pre>
<h3>Remove User from Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/removeUser
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "ProjectId": 950835844418117632,
    "UserId": 949716012092100608
}
Return Body: NONE
------------	
Notes:

#You require administrator permissions to remove a user to a project</code></pre>
<h3>Load Owner of Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/loadOwner
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "Id": 963475102257651712
}
Return Body:
{
    "Id": 963469917997244416,
    "Name": null,
    "Owner": {
        "Data": {
            "Item1": {
                "Id": 963460958875815936,
                "Email": "john@doe.mail",
                "UserName": "JohnDoe",
                "LastName": "John",
                "FirstName": "Doe",
                "PasswordHash": null,
                "KnownIps": [],
                "Projects": [],
                "Flags": 18,
                "CreationDate": "2022-04-12T15:34:31.300681Z",
                "TTL": "2022-09-05T11:17:50.155621Z"
            },
            "Item2": 963460958875815936
        },
        "IsLoaded": true
    },
    "LastModifiedUser": null,
    "Users": null,
    "ApiTokens": null,
    "Flags": 0,
    "CreationDate": "0001-01-01T00:00:00",
    "LastModifiedAt": "0001-01-01T00:00:00",
    "TTL": null
}
------------	
Notes:

#You require read permissions to load the owner of a Project

#You can serve us a PamProject JSON object with only the ID loaded, which is what we recommend. 
#However you can also serve us all data, doing so might increase load times</code></pre>
<h3>Load Last Modified User of Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/loadLastmodifiedUser
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "Id": 963475102257651712
}
Return Body:
{
    "Id": 963469917997244416,
    "Name": null,
    "Owner": null,
    "LastModifiedUser": {
        "Data": {
            "Item1": {
                "Id": 963460958875815936,
                "Email": "john@doe.mail",
                "UserName": "JohnDoe",
                "LastName": "John",
                "FirstName": "Doe",
                "PasswordHash": null,
                "KnownIps": [],
                "Projects": [],
                "Flags": 18,
                "CreationDate": "2022-04-12T15:34:31.300681Z",
                "TTL": "2022-09-05T11:17:50.155621Z"
            },
            "Item2": 963460958875815936
        },
        "IsLoaded": true
    },
    "Users": null,
    "ApiTokens": null,
    "Flags": 0,
    "CreationDate": "0001-01-01T00:00:00",
    "LastModifiedAt": "0001-01-01T00:00:00",
    "TTL": null
}
------------	
Notes:

#You require read permissions to load the last modified user of a Project

#You can serve us a PamProject JSON object with only the ID loaded, which is what werecommend. 
#However you can also serve us all data, doing so might increase load times</code></pre>
<h3>Load API Tokens of Project</h3>
<pre><code class="language-plaintext">Request Type: POST
Request Url: /db/v1/project/loadLastmodifiedUser
Authorization: JWT Bearer
Content-Type: application/json
Request Body: 
{
    "Id": 963475102257651712
}
Return Body:
{
    "Id": 963469917997244416,
    "Name": null,
    "Owner": null,
    "LastModifiedUser": {
        "Data": {
            "Item1": {
                "Id": 963460958875815936,
                "Email": "john@doe.mail",
                "UserName": "JohnDoe",
                "LastName": "John",
                "FirstName": "Doe",
                "PasswordHash": null,
                "KnownIps": [],
                "Projects": [],
                "Flags": 18,
                "CreationDate": "2022-04-12T15:34:31.300681Z",
                "TTL": "2022-09-05T11:17:50.155621Z"
            },
            "Item2": 963460958875815936
        },
        "IsLoaded": true
    },
    "Users": null,
    "ApiTokens": null,
    "Flags": 0,
    "CreationDate": "0001-01-01T00:00:00",
    "LastModifiedAt": "0001-01-01T00:00:00",
    "TTL": null
}
------------	
Notes:

#You require read permissions to load the last modified user of a Project

#You can serve us a PamProject JSON object with only the ID loaded, which is what werecommend. 
#However you can also serve us all data, doing so might increase load times</code></pre>
<h3>Load Projects Users</h3>
<p>&nbsp;</p>
<h3>Check User Permissions on Project</h3>
<p>&nbsp;</p>
<h3>Give User Permissions on Project</h3>
<p>&nbsp;</p>
<p>&nbsp;</p>
